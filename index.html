<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>8‑Head Fixed‑Frame Capture</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      text-align: center;
      background: #f0f0f0;
      color: #333;
    }
    h1 { margin: 1rem 0 0.5rem; }
    #instructions { margin-bottom: 1rem; }
    #camera-container {
      position: relative;
      display: inline-block;
      background: #000;
      /* we'll size this to the video dimensions in JS */
    }
    video {
      display: block;
      width: 100%;
      height: auto;
    }
    canvas#overlay {
      position: absolute;
      top: 0; left: 0;
      pointer-events: none;
    }
    #controls {
      margin: 1rem 0;
    }
    button {
      font-size: 1rem;
      padding: 0.5rem 1rem;
      margin: 0 0.5rem;
    }
    #countdown {
      font-size: 2rem;
      font-weight: bold;
      color: #d00;
      height: 2rem;
    }
  </style>
</head>
<body>
  <h1>8‑Head Fixed‑Frame Capture</h1>
  <p id="instructions">
    Position your <strong>entire body</strong> inside the box.  
    When ready, click “Capture” and hold still for the countdown.
  </p>

  <div id="camera-container">
    <video id="video" autoplay playsinline></video>
    <canvas id="overlay"></canvas>
  </div>

  <div id="controls">
    <button id="capture-btn">📸 Capture Photo</button>
    <div id="countdown"></div>
  </div>

  <script>
    const video = document.getElementById('video');
    const overlay = document.getElementById('overlay');
    const ctx = overlay.getContext('2d');
    const btn = document.getElementById('capture-btn');
    const cd = document.getElementById('countdown');

    // 1) grab camera
    navigator.mediaDevices.getUserMedia({
      video: { facingMode: 'user' },
      audio: false
    }).then(stream => {
      video.srcObject = stream;
      video.addEventListener('loadedmetadata', () => {
        // size container + overlay to match actual video resolution
        const W = video.videoWidth;
        const H = video.videoHeight;
        const container = document.getElementById('camera-container');
        container.style.width  = W + 'px';
        container.style.height = H + 'px';
        overlay.width  = W;
        overlay.height = H;

        drawOverlay();
      });
    }).catch(err => {
      alert('Could not access camera:\n' + err);
    });

    // 2) draw the fixed‑frame box (full height, 80% width, centered)
    function drawOverlay() {
      const W = overlay.width, H = overlay.height;
      ctx.clearRect(0,0,W,H);
      const boxW = W * 0.8;
      const boxH = H;
      const x0   = (W - boxW)/2;
      ctx.lineWidth = 6;
      ctx.strokeStyle = 'lime';  // always green
      ctx.strokeRect(x0, 0, boxW, boxH);
    }

    // 3) capture on button click with a 3 second countdown
    btn.addEventListener('click', () => {
      let count = 3;
      cd.textContent = count;
      const timer = setInterval(() => {
        count -= 1;
        if (count > 0) {
          cd.textContent = count;
        } else {
          clearInterval(timer);
          cd.textContent = '';
          doCapture();
        }
      }, 1000);
    });

    // 4) actually grab the frame and download as PNG
    function doCapture() {
      const W = video.videoWidth;
      const H = video.videoHeight;
      const capture = document.createElement('canvas');
      capture.width  = W;
      capture.height = H;
      const cctx = capture.getContext('2d');
      // draw the raw video frame—no resizing
      cctx.drawImage(video, 0, 0, W, H);
      // and download
      capture.toBlob(blob => {
        const url = URL.createObjectURL(blob);
        const a   = document.createElement('a');
        a.href    = url;
        a.download= 'aramandi.png';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }, 'image/png');
    }
  </script>
</body>
</html>
